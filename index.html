<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <title>RuangSejarah RPG - Perjuangan Wilayah</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    :root {
      --primary: #064e3b;
      --accent: #059669;
      --bg: #f0fdf4;
      --danger: #be123c;
      --gold: #d97706;
    }
    body {
      margin: 0;
      font-family: 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
      background: var(--bg);
      color: #1f2937;
    }
    header {
      background: var(--primary);
      color: white;
      padding: 30px 20px;
      text-align: center;
      border-bottom: 5px solid var(--gold);
    }
    main { max-width: 1000px; margin: 30px auto; padding: 0 20px; }
    .card {
      background: white;
      border-radius: 20px;
      padding: 30px;
      box-shadow: 0 15px 35px rgba(0,0,0,0.1);
      border: 1px solid #e5e7eb;
    }
    .stats-container {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 15px;
      margin: 20px 0;
    }
    .stat-box {
      padding: 15px;
      border-radius: 15px;
      text-align: center;
      background: #f8fafc;
      border: 2px solid #f1f5f9;
      transition: 0.3s;
    }
    .stat-box b { font-size: 1.5rem; display: block; }
    .stat-alert { font-size: 0.75rem; font-weight: bold; margin-top: 5px; }

    .map-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
      gap: 10px;
      margin-bottom: 25px;
    }
    .city-node {
      padding: 15px;
      border-radius: 12px;
      text-align: center;
      cursor: pointer;
      background: #64748b;
      color: white;
      font-weight: bold;
      border: 3px solid transparent;
    }
    .city-node.active { border-color: var(--gold); background: var(--accent) !important; transform: scale(1.05); }
    .city-node:hover { opacity: 0.9; }

    button {
      padding: 14px 24px;
      border: none;
      border-radius: 12px;
      background: var(--primary);
      color: white;
      font-weight: bold;
      cursor: pointer;
      font-size: 1rem;
    }
    button.secondary { background: #4b5563; }
    .option-card {
      border: 2px solid #f1f5f9;
      padding: 15px;
      border-radius: 12px;
      margin-top: 10px;
      cursor: pointer;
      transition: 0.2s;
    }
    .option-card:hover { border-color: var(--accent); background: #f0fdf4; }
    .hidden { display: none; }
    textarea { width: 100%; padding: 15px; border-radius: 12px; border: 2px solid #cbd5e1; margin-top: 10px; box-sizing: border-box; }
    
    /* City Colors */
    .batavia { background: #ca8a04; } .yogya { background: #166534; } .surabaya { background: #991b1b; }
    .bandung { background: #1e40af; } .medan { background: #5b21b6; } .manado { background: #0891b2; }
  </style>
</head>
<body>

<header>
  <h1>üèõÔ∏è RuangSejarah RPG: Perjuangan Wilayah</h1>
  <p>Pilih Basis Perjuanganmu dan Tentukan Nasib Bangsa</p>
</header>

<main>
  <div id="home" class="card">
    <h2>Selamat Datang, Komandan</h2>
    <p>Silakan masuk sebagai murid untuk memulai simulasi atau guru untuk melihat rekap.</p>
    <button onclick="showTeamSelection()">üßë‚Äçüéì Mulai Simulasi (Murid)</button>
    <button class="secondary" onclick="promptAdmin()">üë©‚Äçüè´ Panel Guru</button>
  </div>

  <div id="teamSelect" class="card hidden">
    <h2>Pilih Basis Perjuangan (Tim)</h2>
    <p>Setiap wilayah memiliki tantangan dan event unik nantinya.</p>
    <div class="map-grid" id="teamGrid"></div>
    <div id="teamInfo" style="margin-top:20px; font-style: italic;"></div>
    <button id="btnConfirmTeam" class="hidden" onclick="startSim()">Konfirmasi & Mulai Perjuangan ‚Æï</button>
  </div>

  <div id="gameScreen" class="card hidden">
    <div id="statusBadges" style="margin-bottom: 10px;"></div>
    <h2 id="evTitle"></h2>
    <p id="evDesc"></p>

    <div class="stats-container">
      <div class="stat-box" id="box-moral">üß† Moral<br><b id="st-moral">50</b><div class="stat-alert" id="msg-moral"></div></div>
      <div class="stat-box" id="box-logistik">üì¶ Logistik<br><b id="st-logistik">50</b><div class="stat-alert" id="msg-logistik"></div></div>
      <div class="stat-box" id="box-support">üåç Dukungan<br><b id="st-support">50</b><div class="stat-alert" id="msg-support"></div></div>
    </div>

    <div id="mapVisual" class="map-grid"></div>

    <div id="optionsArea"></div>

    <div id="reflectionArea" class="hidden">
      <h3>‚úçÔ∏è Lembar Refleksi Strategi</h3>
      <textarea id="refInput" rows="4" placeholder="Jelaskan mengapa pilihan ini penting bagi tim Anda..."></textarea>
      <button onclick="nextStep()">Kirim & Lanjutkan ‚Æï</button>
    </div>
  </div>

  <div id="adminPanel" class="card hidden">
    <h2>üìä Rekapitulasi Jawaban Murid</h2>
    <div id="adminContent"></div>
    <button class="secondary" onclick="location.reload()">Keluar</button>
  </div>
</main>

<script>
// --- DATA ---
const cities = [
  { id: 'batavia', name: 'Batavia', class: 'batavia', desc: 'Pusat politik dan birokrasi. Bonus: Akses informasi cepat.' },
  { id: 'yogya', name: 'Yogyakarta', class: 'yogya', desc: 'Ibukota perjuangan. Bonus: Semangat moral tinggi.' },
  { id: 'surabaya', name: 'Surabaya', class: 'surabaya', desc: 'Kota pahlawan. Bonus: Kekuatan tempur rakyat.' },
  { id: 'bandung', name: 'Bandung', class: 'bandung', desc: 'Lautan api. Bonus: Taktik bumi hangus.' },
  { id: 'medan', name: 'Medan', class: 'medan', desc: 'Front Area. Bonus: Ketahanan wilayah utara.' },
  { id: 'manado', name: 'Manado', class: 'manado', desc: 'Penjaga Timur. Bonus: Dukungan maritim & udara.' }
];

const generalEvents = [
  { title: "Perang Diponegoro (1825)", desc: "Pihak kolonial melanggar batas tanah leluhur. Rakyat menanti komando Anda.", options: [
    { text: "Gerilya Hutan", effect: { m: 10, l: -10, s: 5 }, out: "Belanda frustasi, tapi suplai menipis." },
    { text: "Diplomasi Keraton", effect: { m: -5, l: 5, s: 15 }, out: "Dukungan luar negeri naik, tapi rakyat merasa kecewa." }
  ]},
  { title: "Tanam Paksa (1830)", desc: "Rakyat dipaksa menanam kopi dan nila. Kelaparan mengancam.", options: [
    { text: "Sembunyikan Hasil Panen", effect: { m: 15, l: 5, s: -10 }, out: "Rakyat kenyang, tapi hukuman kolonial kejam." },
    { text: "Ajukan Petisi ke Ratu Belanda", effect: { m: -5, l: -5, s: 20 }, out: "Dunia mulai mendengar kekejaman di Hindia." }
  ]},
  { title: "Sumpah Pemuda (1928)", desc: "Kongres pemuda sedang berlangsung. Apa pesan utama tim Anda?", options: [
    { text: "Satu Bahasa, Satu Bangsa", effect: { m: 25, l: 0, s: 10 }, out: "Persatuan meledak! Identitas nasional terbentuk." },
    { text: "Otonomi Wilayah Terlebih Dahulu", effect: { m: 5, l: 10, s: -5 }, out: "Logistik lokal aman, tapi persatuan agak rapuh." }
  ]}
];

const teamSpecialEvents = {
  'batavia': { title: "Spesial Batavia: Volksraad", desc: "Anda memiliki kursi di Dewan Rakyat. Gunakan untuk politik?", options: [
    { text: "Interupsi Kebijakan Pajak", effect: { m: 10, l: 10, s: 5 }, out: "Belanda tertekan secara legal." },
    { text: "Boikot Dewan", effect: { m: 15, l: -5, s: 10 }, out: "Rakyat bangga, posisi politik hilang." }
  ]},
  'manado': { title: "Spesial Manado: Peristiwa Merah Putih", desc: "Tentara NICA mencoba menurunkan bendera di Tangsi Putih.", options: [
    { text: "Serbu Tangsi Putih", effect: { m: 20, l: 5, s: -5 }, out: "Bendera berkibar! Semangat Timur membara." },
    { text: "Negosiasi Penyerahan Senjata", effect: { m: 5, l: 15, s: 10 }, out: "Senjata didapat tanpa pertumpahan darah." }
  ]}
  // Kota lain bisa ditambahkan polanya sama
};

// --- LOGIC ---
let state = {
  team: null,
  moral: 50,
  logistik: 50,
  support: 50,
  logs: [],
  currentEv: 0,
  isSpecialDone: false
};

function showTeamSelection() {
  document.getElementById('home').classList.add('hidden');
  document.getElementById('teamSelect').classList.remove('hidden');
  const grid = document.getElementById('teamGrid');
  cities.forEach(c => {
    const div = document.createElement('div');
    div.className = `city-node ${c.class}`;
    div.innerText = c.name;
    div.onclick = () => {
      document.querySelectorAll('.city-node').forEach(n => n.classList.remove('active'));
      div.classList.add('active');
      state.team = c.id;
      document.getElementById('teamInfo').innerText = c.desc;
      document.getElementById('btnConfirmTeam').classList.remove('hidden');
    };
    grid.appendChild(div);
  });
}

function startSim() {
  document.getElementById('teamSelect').classList.add('hidden');
  document.getElementById('gameScreen').classList.remove('hidden');
  renderMap();
  loadEvent();
}

function renderMap() {
  const map = document.getElementById('mapVisual');
  map.innerHTML = '';
  cities.forEach(c => {
    const div = document.createElement('div');
    div.className = `city-node ${c.class} ${state.team === c.id ? 'active' : ''}`;
    div.innerText = c.name;
    map.appendChild(div);
  });
}

function loadEvent() {
  let ev;
  // Cek apakah ada event spesial tim di awal
  if (!state.isSpecialDone && teamSpecialEvents[state.team]) {
    ev = teamSpecialEvents[state.team];
    state.isSpecialDone = true;
  } else if (state.currentEv < generalEvents.length) {
    ev = generalEvents[state.currentEv];
  } else {
    finishGame();
    return;
  }

  document.getElementById('evTitle').innerText = ev.title;
  document.getElementById('evDesc').innerText = ev.desc;
  document.getElementById('optionsArea').innerHTML = '';
  document.getElementById('reflectionArea').classList.add('hidden');

  ev.options.forEach((o, i) => {
    const btn = document.createElement('div');
    btn.className = 'option-card';
    btn.innerHTML = `<strong>${o.text}</strong>`;
    btn.onclick = () => selectOption(o);
    document.getElementById('optionsArea').appendChild(btn);
  });
}

function selectOption(opt) {
  state.moral += opt.effect.m;
  state.logistik += opt.effect.l;
  state.support += opt.effect.s;
  
  document.getElementById('evDesc').innerHTML = `üí° <b>Hasil:</b> ${opt.out}`;
  document.getElementById('optionsArea').innerHTML = '';
  document.getElementById('reflectionArea').classList.remove('hidden');
  
  state.lastChoice = opt.text;
  updateStatsUI();
}

function updateStatsUI() {
  const keys = ['moral', 'logistik', 'support'];
  keys.forEach(k => {
    const val = state[k];
    const el = document.getElementById(`st-${k}`);
    const msg = document.getElementById(`msg-${k}`);
    const box = document.getElementById(`box-${k}`);
    el.innerText = val;

    // Logic Threshold
    if (val <= 30) {
      msg.innerText = "‚ö†Ô∏è KRITIS: Rakyat mulai menyerah!";
      msg.style.color = "red";
      box.style.borderColor = "red";
    } else if (val >= 100) {
      msg.innerText = "üåü LEGENDARIS: Kekuatan Tak Terbendung!";
      msg.style.color = "green";
      box.style.borderColor = "gold";
    } else {
      msg.innerText = "";
      box.style.borderColor = "#f1f5f9";
    }
  });
}

function nextStep() {
  const ref = document.getElementById('refInput').value;
  if(ref.length < 10) return alert("Berikan refleksi yang lebih panjang.");
  
  state.logs.push({
    ev: document.getElementById('evTitle').innerText,
    choice: state.lastChoice,
    ref: ref,
    stats: {m: state.moral, l: state.logistik, s: state.support}
  });

  // Simpan ke localstorage untuk guru
  let allData = JSON.parse(localStorage.getItem('ruangSejarah_db') || "[]");
  allData.push({team: state.team, logs: state.logs});
  localStorage.setItem('ruangSejarah_db', JSON.stringify(allData));

  state.currentEv++;
  loadEvent();
}

function finishGame() {
  document.getElementById('evTitle').innerText = "üèÅ Perjuangan Selesai";
  document.getElementById('evDesc').innerText = `Tim ${state.team.toUpperCase()} telah menyelesaikan simulasi. Bagaimana nasib Indonesia di tanganmu?`;
  document.getElementById('optionsArea').innerHTML = `<button onclick="location.reload()">Main Lagi</button>`;
}

// --- ADMIN ---
function promptAdmin() {
  const pw = prompt("Masukkan Kata Sandi Guru:");
  if (pw === "Sejarah123") {
    document.getElementById('home').classList.add('hidden');
    document.getElementById('adminPanel').classList.remove('hidden');
    renderAdmin();
  } else {
    alert("Sandi Salah!");
  }
}

function renderAdmin() {
  const data = JSON.parse(localStorage.getItem('ruangSejarah_db') || "[]");
  const cont = document.getElementById('adminContent');
  if(data.length === 0) return cont.innerHTML = "Belum ada data.";
  
  cont.innerHTML = data.map((d, i) => `
    <div style="border:1px solid #ccc; padding:10px; margin-bottom:10px; border-radius:10px;">
      <strong>Murid #${i+1} - Tim: ${d.team}</strong>
      <ul>
        ${d.logs.map(l => `<li>${l.ev}: <i>${l.choice}</i><br><small>${l.ref}</small></li>`).join('')}
      </ul>
    </div>
  `).join('');
}

updateStatsUI();
</script>
</body>
</html>
