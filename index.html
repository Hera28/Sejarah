<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <title>RuangSejarah RPG v4 - Simulasi Strategis Bangsa</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    :root {
      --primary: #1b4332;
      --paper: #fdfaf1;
      --ink: #2b2d42;
      --accent: #bc4749;
      --gold: #b79111;
      --map-water: #a8dadc;
    }
    body {
      margin: 0;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: #1a1a1a;
      color: var(--ink);
    }
    header {
      background: var(--primary);
      color: #fff;
      padding: 20px;
      text-align: center;
      border-bottom: 6px solid var(--gold);
    }
    main { max-width: 1200px; margin: 20px auto; padding: 0 15px; }
    
    .card {
      background: var(--paper);
      border-radius: 12px;
      padding: 30px;
      box-shadow: 0 15px 30px rgba(0,0,0,0.4);
      border: 2px solid var(--gold);
    }

    /* MAP INDONESIA STYLIZED */
    .map-box {
      width: 100%;
      height: 300px;
      background: var(--map-water);
      border: 4px solid var(--primary);
      position: relative;
      border-radius: 8px;
      overflow: hidden;
      margin-bottom: 20px;
    }
    .island {
      position: absolute;
      background: #79a37d;
      border: 2px solid #386641;
      border-radius: 20% 50%;
    }
    .marker {
      position: absolute;
      width: 14px;
      height: 14px;
      background: #333;
      border: 2px solid white;
      border-radius: 50%;
      cursor: pointer;
      z-index: 5;
    }
    .marker.active { background: var(--accent); transform: scale(1.3); box-shadow: 0 0 10px var(--accent); }
    .marker:hover::after {
      content: attr(data-name);
      position: absolute;
      top: -25px;
      left: 50%;
      transform: translateX(-50%);
      background: rgba(0,0,0,0.8);
      color: white;
      padding: 2px 8px;
      font-size: 12px;
      border-radius: 4px;
      white-space: nowrap;
    }

    /* STATS BAR */
    .stats-row { display: grid; grid-template-columns: repeat(3, 1fr); gap: 15px; margin: 20px 0; }
    .stat-card {
      background: #fff;
      padding: 15px;
      border-bottom: 4px solid var(--primary);
      text-align: center;
      border-radius: 8px;
    }
    .stat-card b { font-size: 24px; color: var(--primary); }

    /* INPUTS & BUTTONS */
    .input-group { margin: 20px 0; }
    input[type="text"] { width: 100%; padding: 12px; border: 2px solid #ccc; border-radius: 8px; font-size: 16px; }
    button {
      background: var(--primary);
      color: white;
      padding: 12px 24px;
      border: none;
      border-radius: 8px;
      font-weight: bold;
      cursor: pointer;
      transition: 0.3s;
    }
    button:hover { background: #2d6a4f; transform: translateY(-2px); }
    
    .option-btn {
      display: block;
      width: 100%;
      text-align: left;
      padding: 18px;
      margin: 12px 0;
      background: #fff;
      border: 2px solid #e0e0e0;
      border-radius: 10px;
      cursor: pointer;
      font-size: 15px;
    }
    .option-btn:hover { background: #f1f8f5; border-color: var(--primary); }

    .hidden { display: none; }
    #world-alert {
      background: #fff3cd;
      color: #856404;
      padding: 10px;
      border-radius: 8px;
      margin-bottom: 10px;
      border-left: 5px solid #ffeeba;
      font-weight: bold;
    }
  </style>
</head>
<body>

<header>
  <h1>üèõÔ∏è RUANGSEJARAH RPG v4</h1>
  <p>Strategi Perjalanan Bangsa (1800‚Äì2000)</p>
</header>

<main>
  <div id="login-screen" class="card">
    <h2>Registrasi Komandan Baru</h2>
    <p>Selamat datang di akademi simulasi sejarah. Masukkan namamu untuk memulai.</p>
    <div class="input-group">
      <input type="text" id="student-name" placeholder="Masukkan Nama Lengkap Anda...">
    </div>
    <button onclick="checkName()">Masuk Simulasi ‚Æï</button>
    <button style="background:#444; margin-left:10px;" onclick="authAdmin()">Panel Guru</button>
  </div>

  <div id="team-screen" class="card hidden">
    <h2>Pilih Wilayah Basis</h2>
    <p>Halo <b id="display-name"></b>, klik titik hitam pada peta untuk memilih kota basis tim perjuanganmu.</p>
    <div class="map-box" id="map-selection">
      <div class="island" style="width:250px; height:80px; top:65%; left:10%;"></div> <div class="island" style="width:120px; height:200px; top:10%; left:5%;"></div> <div class="island" style="width:100px; height:100px; top:35%; left:75%;"></div> </div>
    <div id="team-info" style="margin: 15px 0; font-weight: bold; color: var(--accent);"></div>
    <button id="start-game-btn" class="hidden" onclick="beginSimulation()">Konfirmasi & Mulai Perang Jawa (1825) ‚Æï</button>
  </div>

  <div id="game-screen" class="card hidden">
    <div id="world-alert" class="hidden"></div>
    
    <div class="stats-row">
      <div class="stat-card">üß† Moral<br><b id="st-moral">50</b></div>
      <div class="stat-card">üì¶ Logistik<br><b id="st-logistik">50</b></div>
      <div class="stat-card">üåç Dukungan<br><b id="st-support">50</b></div>
    </div>

    <div id="event-container">
      <h3 id="ev-title"></h3>
      <p id="ev-desc"></p>
      <div id="options-box"></div>
    </div>

    <div id="reflection-box" class="hidden">
      <hr>
      <h4>‚úçÔ∏è Laporan Strategi</h4>
      <p>Mengapa Anda mengambil keputusan ini? Jelaskan dampak jangka panjangnya.</p>
      <textarea id="ref-input" style="width:100%; height:80px; padding:10px; border-radius:8px;" placeholder="Tulis alasanmu di sini..."></textarea>
      <button style="margin-top:15px;" onclick="submitTurn()">Lanjutkan Peristiwa ‚Æï</button>
    </div>
  </div>

  <div id="admin-panel" class="card hidden">
    <h2>üë©‚Äçüè´ Rekapitulasi Kelas (Max 40 Murid)</h2>
    <div id="admin-data" style="max-height:400px; overflow-y:auto; background:white; padding:15px; border:1px solid #ccc;"></div>
    <br>
    <button onclick="location.reload()">Keluar Panel</button>
  </div>
</main>

<script>
// --- DATA CONFIGURATION ---
const teamList = [
  { id:'batavia', name:'Batavia', x:25, y:72, info:'Pusat Administratif: Bonus Dukungan Awal.' },
  { id:'yogya', name:'Yogyakarta', x:35, y:75, info:'Ibukota Perjuangan: Bonus Moral Awal.' },
  { id:'surabaya', name:'Surabaya', x:48, y:75, info:'Kota Pahlawan: Bonus Logistik Awal.' },
  { id:'manado', name:'Manado', x:78, y:38, info:'Benteng Timur: Bonus Ketahanan Maritim.' },
  { id:'medan', name:'Medan', x:12, y:30, info:'Serambi Sumatera: Strategi Gerilya Sumatera.' }
];

const timeline = [
  { t: "1825", title: "Perang Jawa (Diponegoro)", desc: "Belanda memasang patok jalan di atas tanah leluhur. Apa perintah Anda?", options: [
    { text: "Perang Gerilya Menyeluruh", m:20, l:-15, s:5, out:"Belanda kelelahan, tapi desa-desa kekurangan pangan." },
    { text: "Diplomasi & Perundingan", m:-10, l:10, s:15, out:"Harta terjaga, tapi rakyat merasa dikhianati." },
    { text: "Pertahanan Benteng Statis", m:5, l:-5, s:-5, out:"Belanda dengan mudah mengepung posisi Anda." }
  ]},
  { t: "1830", title: "Cultuurstelsel (Tanam Paksa)", desc: "Gubernur Van den Bosch mewajibkan penanaman kopi. Rakyat menderita.", options: [
    { text: "Sabotase & Bakar Gudang", m:15, l:-10, s:-10, out:"Perlawanan rakyat tinggi, ekonomi kolonial terganggu." },
    { text: "Ikuti Aturan Sambil Menimbun Sisa", m:-5, l:20, s:0, out:"Rakyat lapar, tapi tim Anda punya cadangan rahasia." },
    { text: "Kirim Surat Protes ke Parlemen Belanda", m:0, l:0, s:25, out:"Golongan Liberal di Belanda mulai bersimpati." }
  ]},
  { t: "1908", title: "Kebangkitan Nasional", desc: "Organisasi Budi Utomo lahir. Bagaimana Anda membawa gerakan ini?", options: [
    { text: "Fokus Pendidikan Kaum Muda", m:10, l:5, s:15, out:"Lahir generasi intelektual yang cerdas berpolitik." },
    { text: "Gerakan Politik Radikal", m:20, l:-5, s:0, out:"Massa berkobar, namun pemimpin ditangkap." },
    { text: "Bangun Jaringan Ekonomi Bumiputera", m:5, l:15, s:5, out:"Pedagang lokal mulai mandiri dari Belanda." }
  ]},
  { t: "1928", title: "Sumpah Pemuda", desc: "Kongres Pemuda II sedang berlangsung. Apa pesan utama tim Anda?", options: [
    { text: "Satu Bahasa Indonesia", m:25, l:0, s:10, out:"Identitas bangsa menguat secara instan." },
    { text: "Persatuan Militer Pemuda", m:10, l:10, s:-5, out:"Kesiapan tempur naik, namun dipantau ketat intel Belanda." },
    { text: "Fokus Kebudayaan Daerah", m:5, l:5, s:5, out:"Keragaman terjaga, namun persatuan agak melambat." }
  ]},
  { t: "1942", title: "Pendudukan Jepang", desc: "Jepang datang mengusir Belanda. Apa strategi tim Anda?", options: [
    { text: "Kerjasama Taktis (Seinendan)", m:-10, l:20, s:-10, out:"Dapat pelatihan militer, namun rakyat Romusha." },
    { text: "Gerakan Bawah Tanah", m:20, l:-10, s:10, out:"Jaringan pejuang tetap hidup meski berbahaya." },
    { text: "Netral & Fokus Pertahanan Desa", m:5, l:5, s:-5, out:"Desa aman sementara, namun kehilangan momentum politik." }
  ]},
  { t: "1945", title: "Proklamasi Kemerdekaan", desc: "Jepang menyerah. Soekarno-Hatta ragu. Apa yang dilakukan tim Anda?", options: [
    { text: "Desak Proklamasi Segera (Rengasdengklok)", m:30, l:-5, s:15, out:"Merdeka! Dunia terkejut dengan keberanian RI." },
    { text: "Tunggu Janji Jepang (PPKI)", m:-10, l:10, s:5, out:"Transisi rapi, tapi dicap boneka Jepang oleh Sekutu." },
    { text: "Siapkan Pasukan Rebut Kantor Berita", m:10, l:10, s:0, out:"Berita merdeka tersebar luas ke seluruh dunia." }
  ]},
  { t: "1947", title: "Agresi Militer I & PBB", desc: "Belanda menyerang kembali. Dukungan internasional dibutuhkan.", options: [
    { text: "Bawa Isu ke DK PBB", m:5, l:0, s:30, out:"Gencatan senjata dipaksakan oleh dunia internasional." },
    { text: "Serangan Umum 1 Maret", m:25, l:-15, s:10, out:"Membuktikan TNI masih ada di mata dunia." },
    { text: "Taktik Bumi Hangus", m:15, l:-20, s:0, out:"Kota hancur, Belanda tidak mendapat apa-apa." }
  ]},
  { t: "1955", title: "Konferensi Asia Afrika", desc: "Indonesia menjadi tuan rumah KAA di Bandung.", options: [
    { text: "Pimpin Blok Non-Blok", m:15, l:0, s:25, out:"Indonesia menjadi pemimpin negara dunia ketiga." },
    { text: "Fokus Cari Bantuan Ekonomi", m:-5, l:20, s:10, out:"Utang luar negeri bertambah, pembangunan berjalan." },
    { text: "Promosi Kebudayaan Nasional", m:10, l:5, s:10, out:"Citra bangsa di mata dunia sangat positif." }
  ]},
  { t: "1966", title: "Transisi Orde Baru", desc: "Terjadi gejolak politik hebat. Bagaimana stabilitas dijaga?", options: [
    { text: "Fokus Pembangunan Ekonomi (Pelita)", m:5, l:30, s:10, out:"Swasembada pangan tercapai, harga stabil." },
    { text: "Utamakan Kebebasan Pers", m:20, l:-10, s:15, out:"Demokrasi hidup, namun rawan konflik horizontal." },
    { text: "Perkuat Militer Teritorial", m:10, l:10, s:-5, out:"Stabilitas sangat kuat, namun kritik dibatasi." }
  ]},
  { t: "1998", title: "Era Reformasi", desc: "Krisis moneter dan tuntutan mundurnya Presiden Soeharto.", options: [
    { text: "Dukung Gerakan Mahasiswa", m:25, l:-10, s:20, out:"Demokrasi baru lahir! Kebebasan kembali dibuka." },
    { text: "Jaga Ketertiban Nasional", m:5, l:15, s:-10, out:"Kericuhan berkurang, namun perubahan lambat." },
    { text: "Dialog Lintas Tokoh Bangsa", m:15, l:0, s:15, out:"Transisi kekuasaan berjalan damai tanpa darah." }
  ]}
];

// --- GAME LOGIC ---
let state = {
  name: "", team: "", moral: 50, logistik: 50, support: 50,
  currentEv: 0, logs: [], specialTriggered: false
};

function checkName() {
  const name = document.getElementById('student-name').value;
  if(name.length < 3) return alert("Masukkan namamu dengan benar!");
  state.name = name;
  document.getElementById('login-screen').classList.add('hidden');
  document.getElementById('team-screen').classList.remove('hidden');
  document.getElementById('display-name').innerText = name;
  renderMap('map-selection');
}

function renderMap(containerId) {
  const map = document.getElementById(containerId);
  teamList.forEach(t => {
    const dot = document.createElement('div');
    dot.className = 'marker';
    dot.style.left = t.x + "%";
    dot.style.top = t.y + "%";
    dot.setAttribute('data-name', t.name);
    dot.onclick = () => {
      document.querySelectorAll('.marker').forEach(m => m.classList.remove('active'));
      dot.classList.add('active');
      state.team = t.id;
      document.getElementById('team-info').innerText = t.info;
      document.getElementById('start-game-btn').classList.remove('hidden');
    };
    map.appendChild(dot);
  });
}

function beginSimulation() {
  // Bonus awal berdasarkan tim
  if(state.team === 'batavia') state.support += 15;
  if(state.team === 'yogya') state.moral += 15;
  if(state.team === 'surabaya') state.logistik += 15;

  document.getElementById('team-screen').classList.add('hidden');
  document.getElementById('game-screen').classList.remove('hidden');
  loadEvent();
}

function loadEvent() {
  if (state.currentEv >= timeline.length) {
    finishGame();
    return;
  }

  // Intervensi Internasional acak jika support > 75
  const alertBox = document.getElementById('world-alert');
  if (state.support > 75 && Math.random() > 0.6) {
    state.logistik += 10;
    alertBox.innerText = "üåç INTERVENSI: PBB/AS mengirimkan bantuan logistik karena reputasi diplomatik Anda!";
    alertBox.classList.remove('hidden');
  } else {
    alertBox.classList.add('hidden');
  }

  const ev = timeline[state.currentEv];
  document.getElementById('ev-title').innerText = `${ev.t}: ${ev.title}`;
  document.getElementById('ev-desc').innerText = ev.desc;
  
  const box = document.getElementById('options-box');
  box.innerHTML = '';
  ev.options.forEach((opt, i) => {
    const btn = document.createElement('button');
    btn.className = 'option-btn';
    btn.innerHTML = `<b>Pilihan ${i+1}:</b> ${opt.text}`;
    btn.onclick = () => selectOption(opt);
    box.appendChild(btn);
  });

  document.getElementById('reflection-box').classList.add('hidden');
  updateStats();
}

function selectOption(opt) {
  state.moral += opt.m;
  state.logistik += opt.l;
  state.support += opt.s;
  
  document.getElementById('ev-desc').innerHTML = `üí° <b>HASIL:</b> ${opt.out}`;
  document.getElementById('options-box').innerHTML = '';
  document.getElementById('reflection-box').classList.remove('hidden');
  state.lastChoice = opt.text;
  updateStats();
}

function submitTurn() {
  const ref = document.getElementById('ref-input').value;
  if(ref.length < 10) return alert("Berikan laporan strategi yang lebih lengkap (min 10 karakter).");

  state.logs.push({
    event: timeline[state.currentEv].title,
    choice: state.lastChoice,
    ref: ref
  });

  // Simpan data ke localStorage (Database lokal guru)
  let db = JSON.parse(localStorage.getItem('rsh_db') || "[]");
  if(db.length >= 40) db.shift(); // Limit 40
  db.push({ name: state.name, team: state.team, logs: state.logs });
  localStorage.setItem('rsh_db', JSON.stringify(db));

  state.currentEv++;
  document.getElementById('ref-input').value = '';
  loadEvent();
}

function updateStats() {
  document.getElementById('st-moral').innerText = state.moral;
  document.getElementById('st-logistik').innerText = state.logistik;
  document.getElementById('st-support').innerText = state.support;
}

function finishGame() {
  document.getElementById('event-container').innerHTML = `
    <h2>üéâ Simulasi Selesai!</h2>
    <p>Komandan <b>${state.name}</b>, Anda telah memimpin Indonesia melewati 200 tahun sejarah.</p>
    <p>Skor Akhir: Moral ${state.moral}, Logistik ${state.logistik}, Dukungan ${state.support}.</p>
    <button onclick="location.reload()">Mulai Ulang Sesi</button>
  `;
}

// --- ADMIN PANEL ---
function authAdmin() {
  const pw = prompt("Masukkan Sandi Guru:");
  if(pw === "Sejarah123") {
    document.getElementById('login-screen').classList.add('hidden');
    document.getElementById('admin-panel').classList.remove('hidden');
    renderAdmin();
  } else { alert("Sandi Salah!"); }
}

function renderAdmin() {
  const db = JSON.parse(localStorage.getItem('rsh_db') || "[]");
  const cont = document.getElementById('admin-data');
  if(db.length === 0) return cont.innerHTML = "Belum ada data murid.";
  
  cont.innerHTML = db.reverse().map(s => `
    <div style="border-bottom:2px solid #eee; padding:10px;">
      <b>${s.name}</b> (Tim: ${s.team.toUpperCase()})<br>
      <small>${s.logs.length} Peristiwa dilewati</small>
      <details>
        <summary>Lihat Detail Jawaban</summary>
        ${s.logs.map(l => `<p>‚Ä¢ ${l.event}: <i>${l.choice}</i><br>Ref: ${l.ref}</p>`).join('')}
      </details>
    </div>
  `).join('');
}
</script>

</body>
</html>
